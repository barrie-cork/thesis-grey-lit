# üõ†Ô∏è Comprehensive Development Guide\n\n## üö® **MANDATORY READING FOR ALL DEVELOPERS**\n\nThis document outlines **ALL** critical project information that every developer must understand before contributing code.\n\n---\n\n## üìã **CRITICAL ARCHITECTURE ALERTS**\n\n### **üî¥ CUSTOM USER MODEL ALERT**\nThis project uses `accounts.User` (UUID primary key) instead of Django's default `auth.User`.\n\n**MANDATORY DOCUMENTS TO READ:**\n1. **[CUSTOM_USER_ALERT.md](CUSTOM_USER_ALERT.md)** - Critical implementation patterns\n2. **[apps/accounts/README.md](apps/accounts/README.md)** - Custom User model details\n3. **[DEVELOPER_ONBOARDING.md](DEVELOPER_ONBOARDING.md)** - Complete setup checklist\n\n**üö® Failure to use correct User model patterns will cause database errors!**\n\n---\n\n## üìä **Project Architecture Overview**\n\n```\nthesis-grey-lit/\n‚îú‚îÄ‚îÄ apps/\n‚îÇ   ‚îú‚îÄ‚îÄ accounts/           # Custom User model (UUID primary key)\n‚îÇ   ‚îú‚îÄ‚îÄ review_manager/     # Session management (COMPLETED)\n‚îÇ   ‚îú‚îÄ‚îÄ search_strategy/    # PIC framework (Sprint 4)\n‚îÇ   ‚îú‚îÄ‚îÄ serp_execution/     # Search execution (Sprint 5)\n‚îÇ   ‚îú‚îÄ‚îÄ results_manager/    # Results processing (Sprint 6)\n‚îÇ   ‚îú‚îÄ‚îÄ review_results/     # Review workflow (Sprint 7)\n‚îÇ   ‚îî‚îÄ‚îÄ reporting/          # Reports & export (Sprint 10)\n‚îî‚îÄ‚îÄ docs/                   # Comprehensive documentation\n```\n\n### **Working Code Examples**\nBefore writing any User-related code, study these working examples:\n- **`apps/review_manager/models.py`** - Correct ForeignKey usage\n- **`apps/review_manager/views.py`** - Correct User model imports\n- **`apps/review_manager/tests.py`** - Correct test setup\n- **`apps/review_manager/management/commands/`** - Correct command implementation\n\n---\n\n## üíª **Coding Standards**\n\n### **1. Python & Django Standards**\n\n#### **User Model Implementation (CRITICAL)**\n```python\n# ‚úÖ CORRECT - Always use this pattern\nfrom django.contrib.auth import get_user_model\nfrom django.conf import settings\n\nUser = get_user_model()\n\n# In models\nclass MyModel(models.Model):\n    user = models.ForeignKey(\n        settings.AUTH_USER_MODEL,  # ‚úÖ Correct\n        on_delete=models.CASCADE\n    )\n\n# In views and tests\ndef my_view(request):\n    user = User.objects.create_user(...)  # ‚úÖ Correct\n\n# ‚ùå WRONG - Will cause database errors\nfrom django.contrib.auth.models import User  # ‚ùå DON'T DO THIS\n```\n\n#### **Django Best Practices**\n- **PEP 8:** All Python code MUST adhere to PEP 8 style guide\n- **Fat Models, Thin Views:** Business logic in models/services, not views\n- **Django ORM:** Use Django ORM effectively, avoid raw SQL\n- **Class-Based Views:** Use CBVs or FBVs appropriately\n\n#### **Naming Conventions**\n- **Modules:** `lowercase_with_underscores`\n- **Classes:** `CapWords` (e.g., `UserRegistrationForm`)\n- **Functions/Methods:** `lowercase_with_underscores`\n- **Variables:** `lowercase_with_underscores`\n- **Constants:** `UPPERCASE_WITH_UNDERSCORES`\n\n#### **Documentation Standards**\n- **Docstrings:** Use for all modules, classes, functions, methods (PEP 257)\n- **Comments:** Clear explanations for complex code sections\n- **Imports:** Standard library ‚Üí third-party ‚Üí local (with blank lines)\n\n### **2. Security Requirements (MANDATORY)**\n\n#### **User Isolation (CRITICAL)**\n```python\n# ‚úÖ CORRECT - Users can only access their own data\nclass MyView(LoginRequiredMixin, UserPassesTestMixin, View):\n    def test_func(self):\n        obj = self.get_object()\n        return obj.created_by == self.request.user\n```\n\n#### **Security Checklist**\n- **Input Validation:** Validate all user input server-side\n- **CSRF Protection:** Use Django's CSRF protection on all forms\n- **XSS Prevention:** Rely on Django's template auto-escaping\n- **SQL Injection:** Use Django ORM, avoid raw SQL\n- **Authentication:** All views require login unless explicitly public\n- **HTTPS:** Enforce in production\n- **DEBUG Mode:** Must be `False` in production\n\n---\n\n## üß™ **Testing Strategy**\n\n### **Testing Requirements (MANDATORY)**\n- **High Coverage:** Aim for comprehensive test coverage\n- **Multiple Levels:** Unit tests, integration tests, end-to-end tests\n- **Custom User Model:** All tests must use `get_user_model()`\n\n### **Correct Test Setup**\n```python\n# ‚úÖ CORRECT test setup\nfrom django.test import TestCase\nfrom django.contrib.auth import get_user_model\n\nUser = get_user_model()\n\nclass MyTestCase(TestCase):\n    def setUp(self):\n        self.user = User.objects.create_user(\n            username='testuser',\n            password='testpass123'\n        )\n        self.client.login(username='testuser', password='testpass123')\n```\n\n### **What to Test**\n- **Models:** Methods, custom managers, field validations\n- **Forms:** Validation, cleaning methods, saving logic\n- **Views:** Logic, context data, templates, redirects, permissions\n- **APIs:** Endpoints, status codes, authentication, authorization\n- **Services:** Utility functions, business logic\n\n### **Testing Commands**\n```bash\n# Run all tests (must pass before committing)\npython manage.py test\n\n# Run specific app tests\npython manage.py test apps.your_app\n\n# Check coverage\ncoverage run --source='.' manage.py test\ncoverage report\n```\n\n---\n\n## üöÄ **Development Workflow**\n\n### **Git Branching Strategy**\n- **`main`:** Production-ready code (protected)\n- **`develop`:** Integration branch for features\n- **Feature Branches:** `feature/SPRINT-XX-feature-name`\n- **Hotfix Branches:** `hotfix/critical-fix-name`\n\n### **Commit Standards**\n```bash\n# Commit message format\ntype(scope): Short description\n\n# Examples\nfeat(review_manager): Add session duplication functionality\nfix(auth): Correct User model import in tests\ndocs(readme): Update custom user model instructions\ntest(review_manager): Add integration tests for dashboard\n```\n\n### **Pull Request Process**\n1. **Create feature branch** from `develop`\n2. **Implement feature** following all standards\n3. **Write/update tests** ensuring they pass\n4. **Update documentation** if needed\n5. **Submit PR** with clear description\n6. **Code review** by team member\n7. **Merge** after approval and CI passing\n\n---\n\n## üîç **Code Review Checklist**\n\n### **MANDATORY Review Points**\n- [ ] **User Model:** No `from django.contrib.auth.models import User`\n- [ ] **User Model:** All User references use `get_user_model()`\n- [ ] **User Model:** Model ForeignKeys use `settings.AUTH_USER_MODEL`\n- [ ] **Tests:** All tests pass with correct User model setup\n- [ ] **Security:** User isolation implemented correctly\n- [ ] **Performance:** Database queries optimized\n- [ ] **Documentation:** Code is well-documented\n- [ ] **Standards:** Follows PEP 8 and Django best practices\n\n### **Focus Areas**\n- **Correctness:** Implementation matches requirements\n- **Security:** No security vulnerabilities introduced\n- **Performance:** Efficient database usage\n- **Maintainability:** Code is readable and well-structured\n- **Testing:** Adequate test coverage\n\n---\n\n## üõ°Ô∏è **Quality Assurance**\n\n### **Static Analysis & Linting**\n```bash\n# Required tools\nflake8 .                    # Python linting (PEP 8)\nmypy apps/                  # Type checking\npylint apps/                # Additional code analysis\n\n# Pre-commit hooks (automatically run)\npre-commit run --all-files\n```\n\n### **Pre-commit Configuration**\nThe project uses pre-commit hooks to automatically:\n- Check for User model import violations\n- Run linting (flake8)\n- Format code (black)\n- Check for security issues\n- Validate Django migrations\n\n---\n\n## üìä **Performance Standards**\n\n### **Database Optimization**\n```python\n# ‚úÖ Optimized query patterns\nqueryset = MyModel.objects.filter(\n    created_by=request.user\n).select_related('related_field').prefetch_related(\n    'many_to_many_field'\n).annotate(\n    calculated_field=Count('related_items')\n)\n```\n\n### **Performance Requirements**\n- **Dashboard:** Load in < 2 seconds with 100+ sessions\n- **Search:** Return results in < 500ms\n- **API Endpoints:** Respond in < 1 second\n- **Database:** Use indexes for frequently queried fields\n\n---\n\n## üÜò **Error Handling & Debugging**\n\n### **Common User Model Errors**\n```python\n# Error: Manager isn't available; 'auth.User' has been swapped\n# Solution: Use get_user_model() instead of importing User\n\n# Error: Cannot assign User instance\n# Solution: Use settings.AUTH_USER_MODEL in model ForeignKeys\n\n# Error: Test failures with User model\n# Solution: Check test setup uses get_user_model()\n```\n\n### **Logging Standards**\n```python\nimport logging\n\nlogger = logging.getLogger(__name__)\n\n# Log important events\nlogger.info(f'User {user.username} created session {session.title}')\n\n# Log errors with context\nlogger.error(f'Session creation failed for user {user.id}', exc_info=True)\n```\n\n### **Error Handling Patterns**\n```python\n# ‚úÖ Specific exception handling\ntry:\n    session = SearchSession.objects.get(id=session_id, created_by=request.user)\nexcept SearchSession.DoesNotExist:\n    messages.error(request, 'Session not found or access denied')\n    return redirect('review_manager:dashboard')\nexcept Exception as e:\n    logger.error(f'Unexpected error accessing session {session_id}', exc_info=True)\n    messages.error(request, 'An unexpected error occurred')\n    return redirect('review_manager:dashboard')\n```\n\n---\n\n## üéØ **Sprint Implementation Guidelines**\n\n### **Current Status (Sprint 3 Complete)**\n- ‚úÖ **Review Manager:** Fully implemented with comprehensive tests\n- ‚úÖ **Dashboard:** Responsive, accessible, performant\n- ‚úÖ **Authentication:** Custom User model working correctly\n- ‚úÖ **Testing:** 26 passing tests, full coverage\n\n### **Integration Requirements**\nEach new app must:\n1. **Follow User model patterns** from `review_manager`\n2. **Integrate with navigation system**\n3. **Provide fallback URLs** for incomplete features\n4. **Include comprehensive tests** with correct User setup\n5. **Update documentation**\n6. **Implement user isolation** and security\n\n### **Sprint Planning Considerations**\n- **User Model Impact:** How does this feature interact with users?\n- **Navigation Integration:** How does this fit in the workflow?\n- **Testing Strategy:** What new tests are needed?\n- **Performance Impact:** Will this affect load times?\n- **Security Implications:** Are there new security considerations?\n\n---\n\n## üìû **Getting Help & Escalation**\n\n### **Escalation Path**\n1. **Check Documentation:** Review relevant README files and examples\n2. **Study Working Code:** Look at `review_manager` implementation\n3. **Run Tests:** Use existing tests to understand patterns\n4. **Ask Team:** Create tickets with appropriate labels\n5. **Team Lead:** For architectural decisions\n\n### **Common Issues & Solutions**\n- **User Model Errors:** Review CUSTOM_USER_ALERT.md\n- **Test Failures:** Check test setup patterns in review_manager/tests.py\n- **Navigation Issues:** Review SessionNavigationMixin implementation\n- **Performance Problems:** Review database optimization patterns\n\n---\n\n## üìà **Success Metrics & Quality Gates**\n\n### **Code Quality Indicators**\n- [ ] All tests pass ‚úÖ\n- [ ] No User model errors ‚úÖ\n- [ ] Performance benchmarks met ‚úÖ\n- [ ] Security requirements satisfied ‚úÖ\n- [ ] Documentation updated ‚úÖ\n- [ ] Code review approved ‚úÖ\n\n### **Team Readiness Indicators**\n- [ ] All developers understand User model patterns\n- [ ] All developers can run existing tests successfully\n- [ ] All developers know escalation procedures\n- [ ] Code reviews consistently catch issues early\n\n### **Definition of Done**\nFor any new feature to be considered complete:\n1. **Functionality:** Feature works as specified\n2. **Testing:** Comprehensive tests written and passing\n3. **Security:** User isolation and security implemented\n4. **Performance:** Meets performance benchmarks\n5. **Documentation:** Updated relevant documentation\n6. **Review:** Code reviewed and approved\n7. **Integration:** Works with existing navigation/workflow\n\n---\n\n## üîÑ **Continuous Improvement**\n\n### **Regular Reviews**\n- **Weekly Standups:** Any User model or architecture issues?\n- **Sprint Retrospectives:** What development pain points exist?\n- **Monthly Architecture Reviews:** Are standards being followed?\n- **Quarterly Documentation Updates:** Keep guides current\n\n### **Metrics to Track**\n- **Bug Rate:** User model related bugs per sprint\n- **Review Time:** Average time for code reviews\n- **Test Coverage:** Percentage of code covered by tests\n- **Performance:** Page load times and response times\n\n---\n\n**üöÄ Remember: Quality code today prevents debugging nightmares tomorrow!**\n\n**üìù This guide is living documentation - update it as the team learns and grows.**\n